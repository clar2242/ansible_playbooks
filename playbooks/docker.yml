---

#- name: list docker containers
#  hosts: docker
#  tasks:
#  - community.docker.docker_host_info:
#      images: yes
#    register: result
#
#  - ansible.builtin.debug:
#      var: result.host_info

- name: install portainer_agent
  hosts: raspberrypi.thunderweb.co.uk , topcat.thunderweb.co.uk
  tasks:
  - community.docker.docker_container:
      name: portainer_agent
      image: portainer/agent
      restart_policy: always
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - /var/lib/docker/volumes:/var/lib/docker.volumes
      ports:
        - 9001:9001

- name: install cloudflared on pi
  hosts: raspberrypi.thunderweb.co.uk
  tasks:
  - community.docker.docker_container:
      name: cloudflared
      image: visibilityspots/cloudflared:latest
      network_mode: host
      restart_policy: always
